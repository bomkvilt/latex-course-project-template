\input{./modules.tex}

% load common packages
\addModuleCode
{
    \usepackage{comment  } % 
    \usepackage{etoolbox } % usefull tools
    \usepackage{pdflscape} % album layout
    \usepackage{geometry } % fields
    \usepackage{atbegshi } % output routine callbacks
    \usepackage{float}
    \usepackage{placeins}
}{}

% modules
\input{./modules/code.tex}

\addModuleCode
{   % tables
    \usepackage{longtable, ltcaption} % long tables
    \usepackage{multirow,  makecell } % improved table formatting
    \usepackage{tabu,      tabulary } % automatic table row width. \note: \tabu must be called before \hyperref
    \usepackage{threeparttable}       % automatic table caption's width
}{}

\addModuleCode
{   % hyperrefs
    \usepackage[hidelinks]{hyperref}
}{}

% ater \hyperrefs
\input{./modules/math.tex}
\input{./modules/lang/ru.tex}

\addModuleCode
{   % common typography
    \usepackage{soulutf8} % multiline underlines and strikethroughs
    \usepackage{icomma}   % support of comma in equations' digits
    \usepackage[hyphenation, lastparline]{impnattypo}
}{}

\addModuleCode
{   % vector graphics
    \usepackage{tikz}
}{}

\addModuleCode 
{   % figures
    \usepackage{graphicx}
    \usepackage{caption }
    \usepackage{subcaption}
    \usepackage{pdfpages}   % external PDF files
}{}

\addModuleCode
{   % counters
    \usepackage[figure,table]{totalcount}
    \usepackage{totcount}
    \usepackage{totpages}
}{}

\makeatletter
\addModuleCode
{   % references
    \usepackage[english,russian]{cleveref}
    \usepackage{kvsetkeys} 
} {
    % support of white spaces in \labelcref https://tex.stackexchange.com/a/340502/104425
    \let\org@@cref\@cref
    \renewcommand*{\@cref}[2] 
    {
        \edef \process@me 
        {
            \noexpand\org@@cref{#1} {\zap@space#2 \@empty}
        }
        \process@me
    }
}
\makeatother

\addModuleCode
{
    \usepackage{placeins} % \FloatBarrier
}{}

% modules
\input{./modules/sections/module.tex}
\input{./modules/biblio.tex}
\input{./modules/frames.tex}
\input{./modules/acronyms.tex}
\input{./modules/enums.tex}
\input{./modules/accents.tex}
