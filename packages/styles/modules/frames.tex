\usepackage{afterpage}


\texCode{<<}
    % boolean constants
    \bool_const:Nn \pack@frame@false {0}
    \bool_const:Nn \pack@frame@true  {1}


    %%% print frame from rules
    %   #1  - vertical   lines          - x0;y0;len
    %   #2  - horisontal lines          - x0;y0;len
    %   #3  - text cells (boxes)        - x0;y0;dx;dy;text
    %   #4  - text cells (no bordered)  - x0;y0;dx;dy;text
    \NewDocumentCommand{\pack@frames@render} { m m m m }
    {
        \unitlength = 1mm
        \footnotesize\noindent\hbox{\vbox{
            \noindent\begin{picture}(185,287)(10,6)
                \linethickness{0.5mm}
                \clist_map_inline:nn {#1}
                {
                    \regex_split:nnN {;} {##1} \l@temp_seq
                    \seq_pop:NN \l@temp_seq \l@temp_a_tl
                    \seq_pop:NN \l@temp_seq \l@temp_b_tl
                    \seq_pop:NN \l@temp_seq \l@temp_c_tl
                    \pack@frame@line:VVnnV \l@temp_a_tl \l@temp_b_tl {0}{1} \l@temp_c_tl
                }
                \clist_map_inline:nn {#2}
                {
                    \regex_split:nnN {;} {##1} \l@temp_seq
                    \seq_pop:NN \l@temp_seq \l@temp_a_tl
                    \seq_pop:NN \l@temp_seq \l@temp_b_tl
                    \seq_pop:NN \l@temp_seq \l@temp_c_tl
                    \pack@frame@line:VVnnV \l@temp_a_tl \l@temp_b_tl {1}{0} \l@temp_c_tl
                }
                \clist_map_inline:nn {#3}
                {
                    \regex_split:nnN {;} {##1} \l@temp_seq
                    \seq_pop:NN \l@temp_seq \l@temp_a_tl
                    \seq_pop:NN \l@temp_seq \l@temp_b_tl
                    \seq_pop:NN \l@temp_seq \l@temp_c_tl
                    \seq_pop:NN \l@temp_seq \l@temp_d_tl
                    \seq_pop:NN \l@temp_seq \l@temp_e_tl
                    \pack@frame@cell:VVVVVN \l@temp_a_tl \l@temp_b_tl \l@temp_c_tl \l@temp_d_tl \l@temp_e_tl \pack@frame@true
                }
                \clist_map_inline:nn {#4}
                {
                    \regex_split:nnN {;} {##1} \l@temp_seq
                    \seq_pop:NN \l@temp_seq \l@temp_a_tl
                    \seq_pop:NN \l@temp_seq \l@temp_b_tl
                    \seq_pop:NN \l@temp_seq \l@temp_c_tl
                    \seq_pop:NN \l@temp_seq \l@temp_d_tl
                    \seq_pop:NN \l@temp_seq \l@temp_e_tl
                    \pack@frame@cell:VVVVVN \l@temp_a_tl \l@temp_b_tl \l@temp_c_tl \l@temp_d_tl \l@temp_e_tl \pack@frame@false
                }
            \end{picture}
        }}
    }


    %%% print line
    %   #1  - initial.x     #3  - direction.x   #5  - length
    %   #2  - initial.y     #4  - direction.y
    \cs_new_protected:Npn \pack@frame@line:nnnnn #1 #2 #3 #4 #5
    {
        \put(#1,#2){ \line(#3,#4){#5} }
    }
    \cs_generate_variant:Nn \pack@frame@line:nnnnn { VVnnV }
    
    
    %%% print text cell
    %   #1  - initial.x     #3  - direction.x   #5  - text
    %   #2  - initial.y     #4  - direction.y   #6  - bPrintFrame
    \cs_new_protected:Npn \pack@frame@cell:nnnnnN #1 #2 #3 #4 #5 #6
    {
        \bool_if:nTF #6
        { \put(#1,#2){ \framebox(#3,#4){#5} } }
        { \put(#1,#2){ \makebox (#3,#4){#5} } }
    }
    \cs_generate_variant:Nn \pack@frame@cell:nnnnnN { VVVVVN }


    \NewDocumentCommand{\pack@frames@stamp@a}{ s }
    {
        \pack@frames@render
        { 7;25;15, 17;0;40, 40;0;40, 55;0;40, 65;0;40, 135;0;25, 150;15;10, 165;15;10, 140;15;5, 145;15;5 } 
        { 0;5;65, 0;10;65, 0;15;65, 0;20;65, 0;25;185, 0;30;65, 0;35;65, 0;40;185, 135;15;50, 135;20;50 }
        { 0;0;185;287; }
        {
            0   ; 25 ; 7   ; 5  ; Лит.     ,
            7   ; 25 ; 10  ; 5  ; Изм.     ,
            17  ; 25 ; 23  ; 5  ; №~докум. ,
            40  ; 25 ; 15  ; 5  ; Подп.    ,
            55  ; 25 ; 10  ; 5  ; Дата     ,
            135 ; 20 ; 15  ; 5  ; Лит.     ,
            150 ; 20 ; 15  ; 5  ; Лист     ,
            165 ; 20 ; 20  ; 5  ; Листов   ,
            65  ; 25 ; 110 ; 15 ; \large document name,
            175 ; 15 ; 20  ; 5  ; \thepage
        }
    }


    \NewDocumentCommand{\pack@frames@stamp@b}{ s }
    {
        \pack@frames@render 
        { 7;0;15, 17;0;15, 40;0;15, 55;0;15, 65;0;15, 175;0;15 } 
        { 0;5;65, 0;10;65, 0;15;185, 175;10;10 } 
        { 0;0;185;287; }
        {
            0   ; 0  ; 7   ; 5  ; Лит.     ,
            7   ; 0  ; 10  ; 5  ; Изм.     ,
            17  ; 0  ; 23  ; 5  ; №~докум. ,
            40  ; 0  ; 15  ; 5  ; Подп.    ,
            55  ; 0  ; 10  ; 5  ; Дата     ,
            175 ; 10 ; 10  ; 5  ; Лист     ,
            65  ; 0  ; 110 ; 15 ; \large document name,
            175 ; 0  ; 10  ; 10 ; \normalsize\thepage
        }
    }
    
    \def\pack@frame@clb 
    {
    }

    \NewDocumentCommand{\setLayout}{ m }
    {
        \newpage
        \str_case_e:nn {#1}
        {
            {a4_port_none} {
                \geometry{
                    left   = 30mm,
                    top    = 10mm,
                    right  = 10mm,
                    bottom = 10mm
                }
            }
            {a4_port_first} {
                \newgeometry{
                    hmargin = { 0mm, 0mm },
                    left    = 30mm,
                    right   = 15mm,
                    top     = 15mm,
                    bottom  = 48mm
                }
                \let\pack@frame@clb \pack@frames@stamp@a
            }
            {a4_port_second} {
                \restoregeometry
                \newgeometry{
                    hmargin = { 0mm, 0mm },
                    left    = 30mm,
                    right   = 15mm,
                    top     = 15mm,
                    bottom  = 25mm
                }
                \let\pack@frame@clb \pack@frames@stamp@b
            }
        }
    }

    %%% render a page stamp
    %   #1  - page number
    \NewDocumentCommand{\pack@frames@stamp}{ m }
    {
        \pack@frame@clb
    }

    \NewDocumentCommand{\pack@frames@stamp@end}{ m }
    {}

\texCode{>>}


\makeatletter
    % set default page settings
    \setLayout{a4_port_none}
    \setcounter{page}{0}

    % setup on-header hooks
    \pagestyle{headings}
    \def\@evenhead{ \pack@frames@stamp    {\thepage} }
    \def\@oddhead { \pack@frames@stamp    {\thepage} }
    \def\@evenfoot{ \pack@frames@stamp@end{\thepage} }
    \def\@oddfoot { \pack@frames@stamp@end{\thepage} }
\makeatother
