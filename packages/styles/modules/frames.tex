\usepackage{afterpage}


\texCode{<<}
    % current frame callback
    \def\frame@clb {}

    % frame settings
    \def\@frames@frameSize@x{185}
    \def\@frames@frameSize@y{287}
    \def\@frames@framePos@x {10 }
    \def\@frames@framePos@y {3  }


% -----------------| lines.begin
% <<
    %%% draw a horisontal line
    %   #1  - line thickness
    %   #2  - list of lines - x0;y0;len, ...
    \NewDocumentCommand{\frames@HL}{ m m }
    {
        \frames@line:nnn{#1}{#2}{1,0}
    }


    %%% draw a vertical line
    %   #1  - line thickness
    %   #2  - list of lines - x0;y0;len, ...
    \NewDocumentCommand{\frames@VL}{ m m }
    {
        \frames@line:nnn{#1}{#2}{0,1}
    }

    %%% print line
    %   #1  - line thickness
    %   #2  - list of lines  - x0;y0;len, ...
    %   #3  - line direction - dx,dy
    \cs_new_protected:Npn \frames@line:nnn #1 #2 #3
    {
        \unitlength = 1mm
        \linethickness{#1}
        \clist_map_inline:nn {#2}
        {
            \regex_split:nnN {;} {##1} \l@temp_seq
            \seq_pop:NN \l@temp_seq \l@Xo
            \seq_pop:NN \l@temp_seq \l@Yo
            \seq_pop:NN \l@temp_seq \l@len
            \put(\l@Xo, \l@Yo){ \line(#3){\l@len} }
        }
    }
% <<
% -----------------| lines.end
% -----------------| frames.begin
% <<
    %%% print text with optional frame
    %   #1  - frame thickness
    %   #2  - list of cells   - x0;y0;dx;dy;text, ...
    \NewDocumentCommand{\frames@cell}{ o m }
    {
        \IfNoValueTF{#1} { } 
        {
            \linethickness{#1}
        }
        \unitlength = 1mm
        \clist_map_inline:nn {#2}
        {
            \regex_split:nnN {;} {##1} \l@temp_seq
            \seq_pop:NN \l@temp_seq \l@Xo
            \seq_pop:NN \l@temp_seq \l@Yo
            \seq_pop:NN \l@temp_seq \l@dX
            \seq_pop:NN \l@temp_seq \l@dY
            \seq_pop:NN \l@temp_seq \l@text

            \IfNoValueTF{#1}
            { \put(\l@Xo,\l@Yo){ \makebox (\l@dX,\l@dY){\l@text} } }
            { \put(\l@Xo,\l@Yo){ \framebox(\l@dX,\l@dY){\l@text} } }
        }
    }
% <<
% -----------------| frames.end

    %%% print frame from rules
    %   #1  - draw commands (\frames@cell, \frames@line, \frames@HL, \frames@VL)
    \def\frames@render#1
    {   
        \begingroup
        \unitlength = 1mm
        \let \dX \@frames@frameSize@x
        \let \dY \@frames@frameSize@y
        \let \Xo \@frames@framePos@x
        \let \Yo \@frames@framePos@y
        \noindent\begin{picture}(\dX,\dY)(\Xo,\Yo)
            #1
        \end{picture}
        \endgroup
    }
    

    \NewDocumentCommand{\frames@stamp@a_four_one}{ s }
    {
        \frames@render
        {
            \frames@VL{0.5mm} { 7;25;15, 17;0;40, 40;0;40, 55;0;40, 65;0;40, 135;0;25, 150;15;10, 165;15;10, 140;15;5, 145;15;5 }
            \frames@HL{0.5mm} { 0;25;185, 0;30;65, 0;40;185, 135;15;50, 135;20;50 }
            \frames@HL{0.2mm} { 0;5;65, 0;10;65, 0;15;65, 0;20;65, 0;35;65 }
            \frames@cell[0.5mm] { 0;0;185;287; }
            \frames@cell
            { % x0  ; y0 ; dx  ; dy ; text
                0   ; 25 ; 7   ; 5  ; Лит.     ,
                7   ; 25 ; 10  ; 5  ; Изм.     ,
                17  ; 25 ; 23  ; 5  ; №~докум. ,
                40  ; 25 ; 15  ; 5  ; Подп.    ,
                55  ; 25 ; 10  ; 5  ; Дата     ,
                135 ; 20 ; 15  ; 5  ; Лит.     ,
                150 ; 20 ; 15  ; 5  ; Лист     ,
                165 ; 20 ; 20  ; 5  ; Листов   ,
                65  ; 25 ; 110 ; 15 ; \large document name,
                150 ; 15 ; 15  ; 5  ; \thepage
            }
        }
    }


    \NewDocumentCommand{\frames@stamp@a_four_n}{ s }
    {
        \frames@render
        {
            \frames@VL{0.5mm} { 7;0;15, 17;0;15, 40;0;15, 55;0;15, 65;0;15, 175;0;15 } 
            \frames@HL{0.5mm} { 0;5;65, 175;10;10, 0;15;185 }
            \frames@HL{0.2mm} { 0;10;65 }
            \frames@cell[0.5mm] { 0;0;185;287; }
            \frames@cell
            { % x0  ; y0 ; dx  ; dy ; text
                0   ; 0  ; 7   ; 5  ; Лит.     ,
                7   ; 0  ; 10  ; 5  ; Изм.     ,
                17  ; 0  ; 23  ; 5  ; №~докум. ,
                40  ; 0  ; 15  ; 5  ; Подп.    ,
                55  ; 0  ; 10  ; 5  ; Дата     ,
                175 ; 10 ; 10  ; 5  ; Лист     ,
                65  ; 0  ; 110 ; 15 ; \large document name,
                175 ; 0  ; 10  ; 10 ; \normalsize\thepage
            }
        }
    }


    \NewDocumentCommand{\setNextLayout}{ m }
    {
        \restoregeometry
        \frames@setLayout{#1}
    }
    \NewDocumentCommand{\setLayout}{ m }
    {
        \newpage\restoregeometry
        \frames@setLayout{#1}
    }
    \NewDocumentCommand{\frames@setLayout}{ m }
    {
        \str_case_e:nn {#1} {
        {a4_port_none} {
            \geometry{
                left   = 30mm,
                top    = 10mm,
                right  = 10mm,
                bottom = 10mm,
            }
        }
        {a4_port_1st} {
            % It's impossible to automatically change page layout
            % https://tex.stackexchange.com/questions/65571/change-page-layout-after-first-page
            \newgeometry {
                hmargin = { 0mm, 0mm },
                left    = 30mm,
                right   = 15mm,
                top     = 12mm,
                bottom  = 52mm,
            }
            \global\let \frame@clb \frames@stamp@a_four_one
        }
        {a4_port_nth} {
            \newgeometry {
                hmargin = { 0mm, 0mm },
                left    = 30mm,
                right   = 12mm,
                top     = 15mm,
                bottom  = 23mm,
            }
            \global\let \frame@clb \frames@stamp@a_four_n
        }}
    }


    %%% render a page stamp
    %   #1  - page number
    %   \note: must be called with header and footer callbacks
    \NewDocumentCommand{\frames@stamp}{ m }
    {
        \frame@clb
    }
    \NewDocumentCommand{\frames@stamp@end}{ m }
    {
    }
\texCode{>>}


\makeatletter
    % set default page settings
    \frames@setLayout{a4_port_none}
    \setcounter{page}{0}

    % setup on-header hooks
    \pagestyle{headings}
    \def\@evenhead{ \frames@stamp    {\thepage} }
    \def\@oddhead { \frames@stamp    {\thepage} }
    \def\@evenfoot{ \frames@stamp@end{\thepage} }
    \def\@oddfoot { \frames@stamp@end{\thepage} }
\makeatother
