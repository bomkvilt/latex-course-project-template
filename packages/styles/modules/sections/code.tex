
\usepackage{xifthen }

% -----------------| callbacks.begin
% >>

%%% start section enviroment
\NewDocumentCommand{\styles@sections@onLoad}{}
{
    % start section's scope
    \bool_gset_true:N \styles@sections@g@bInSection
    % include autogenerated file with section constants
    \input{./\styles@sections@autogen}
    % set graphics seqrch paths
    % \note: terminating / is required
    \graphicspath{ {\frmDSectionPath/\frmRRootFigures/} {\frmRRootFigures/} }
}


%%% end section enviroment
\NewDocumentCommand{\styles@sections@onDrop}{}
{   
    % close section's 'scope'
    \bool_gset_false:N \styles@sections@g@bInSection
}


%%% include the section
\NewDocumentCommand{\styles@sections@onSection@alias}{}
{   
    \include{\curfile/main}
    \dontIncludeSelf
}
\NewDocumentCommand{\styles@sections@onSection}{}
{
    % check if the section isn't regestred
    \ifinlist {\frmNameSection}{\styles@sections@g@addedSections_seq} 
    {
        \dontIncludeSelf
        \PackageError{sectoins}{It's not possible to include a \frmNameSection section twice}{}
        \stop
    } {}

    % register the section
    \seq_gpush:Nn \styles@sections@g@addedSections_seq {\frmNameSection}

    % register an appendix if exists
    \IfFileExists{\curdir/appx.tex} 
    {
        \seq_gpush:Nn \styles@sections@g@knownAppendices_seq {\frmNameSection}
    } {}
}


% >>
% -----------------| callbacks.end
% -----------------| private.begin
% >>


\tl_new:N   \styles@sections@l@void_tl  % dummy variable
\tl_new:N   \styles@sections@l@temp_tl  % variable to be used in-place
\str_new:N  \styles@sections@l@temp_str % variable to be used in-place


% >>
% -----------------| private.end
% -----------------| resources.begin
% >>

\def\styles@sections@figPrefix{fig:\frmNameSection--}
\def\styles@sections@eqsPrefix{eqs:\frmNameSection--}


%%% Include an equatoin into a section
%   @equation_path      - /eqs - relative equation path
%   ?equation_label     - the equaition's lable
%       \note:  the labale must be the unique for all EQUATIONS in THE section
\NewDocumentCommand{\IncludeEquation}{ m o } 
{
    \begin{equation}
        \IfValueT{#2} { \label{\styles@sections@eqsPrefix#2} }
        \input{\frmDRootAutogen/\frmRRootEquations/#1.tex}
    \end{equation}
}


%%% Include a figure into a section
%   @figure_path        - /fig - relative figure path
%   ?figure_label       - the figure's lable
%       \note:  the labale must be the unique for all FIGURES in THE section
%   ?caption            - the image's caption
%   ?figure_settings    - settings forwards into a \includegraphics function
\NewDocumentCommand{\IncludeFigure}{ m o o O{ }} {
    \begin{figure}[ht]
        \centering\includegraphics[#4]{#1}
        \IfValueT{#3} { \caption{#3}                }
        \IfValueT{#2} { \label{\styles@sections@figPrefix#2} }
    \end{figure}
}


% Create a reference on the section's equation
%   @equation_label - a label was assigned to an equation during an insertion
\NewDocumentCommand{\req}{ m } {
    \secs_addReference:Nn{\styles@sections@eqsPrefix}{#1}
}


% Create a reference on the section's figure
%   @figure_label   - a label was assigned to a figure during an insertion
\NewDocumentCommand{\rfg}{ m } {
    \secs_addReference:Nn{\styles@sections@figPrefix}{#1}
}


%%% add a reference to a resource
%   @prefix - prefix to be added to all passed lables
%   @names  - list of labels
\seq_new:N \l_secs_labels
\seq_new:N \l_secs_labels_full
\cs_new_protected:Npn \secs_addReference:Nn #1 #2 {
    \seq_clear:N \l_secs_labels_full
    \seq_set_split:Nnn \l_secs_labels {,}{#2}
    \seq_map_inline:Nn \l_secs_labels {
        \seq_push:Nn \l_secs_labels_full {#1 ##1}
    }
    \cref{\seq_use:Nnnn \l_secs_labels_full {,}{,}{,}}
}


% >>
% -----------------| resources.end
