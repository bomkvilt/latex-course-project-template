% -----------------| 
% >>

\str_new:N \sections@eqs@pathPrefix
\str_new:N \sections@eqs@partPrefix


\sections@@@{\sections@@onPart@bgn}
{
    \str_clear:N \sections@eqs@pathPrefix
    \str_clear:N \sections@eqs@partPrefix

    \seq_set_split:NnV \l@list_seq {/} \curdir
    \seq_pop_right:NN  \l@list_seq \l@name_tl
    \str_set:Nx \sections@eqs@partPrefix {\l@name_tl--}
}

\sections@@@{\sections@@onPart@end}
{
    \str_clear:N \sections@eqs@pathPrefix
    \str_clear:N \sections@eqs@partPrefix
}

% >>
% -----------------| 
% -----------------| 
% >>

\NewDocumentCommand{\setEqsRoot}{ m }
{
    \str_set:Nx \sections@eqs@pathPrefix {#1}
}


%%% include an equation into a section (* -> global)
%   #1  - don't use a \sections@eqs@pathPrefix - relative equation paths
%   #3  - equation path
%   #2  - use a global equation labeling instead of a part-local one
%   #4  - equation labeling
\NewDocumentCommand{\addEquation}{ s m s o }
{{
    \bool_if:nT {#1 || #3}
    {
        \sections@check@isInPart
    }    
    
    \bool_if:nTF {#1}
    { \tl_set:Nx \l@path_tl {#2} }
    { \tl_set:Nx \l@path_tl {\sections@eqs@pathPrefix#2} }

    \bool_if:nTF { #3 || \tl_if_novalue_p:n{#4} }
    { \tl_set:Nx \l@label_tl {#4} }
    { \tl_set:Nx \l@label_tl {\sections@eqsPrefix\sections@eqs@partPrefix#4} }

    \input{\frmDRootAutogen/\frmRRootEquations/\l@path_tl.tex}
    % -> \printEquations
    % -> \printVarExplTable
    
    \tl_if_eq:NNTF \l@label_tl \c_novalue_tl
    { \printEquations }
    { \printEquations[\l@label_tl] }

    \printVarExplTable{Где:}
}}


% Create a reference on the section's equation
%   #1  - use a global equation labeling instead of a part-local one
%   #2  - a label was assigned to an equation during an insertion
%   #3  - internal label
\NewDocumentCommand{\req}{ s m o } 
{{
    \tl_set:Nx \l@prefix_tl {}
    \bool_if:nF {#1}
    { 
        \tl_put_right:NV \l@prefix_tl \sections@eqsPrefix
        \tl_put_right:NV \l@prefix_tl \sections@eqs@partPrefix 
    }

    \tl_set:Nx \l@label_tl {#2}
    \tl_if_novalue:nF {#3}
    {
        \tl_put_right:Nx \l@label_tl {--#3}
    }

    \secs_addReference:Nx{\l@prefix_tl}{\l@label_tl}
}}

% >>
% -----------------| 
